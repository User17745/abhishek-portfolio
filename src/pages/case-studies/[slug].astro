---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/layout/Header.astro";
import Footer from "@/components/layout/Footer.astro";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { getCollection } from 'astro:content';
import { ArrowLeft } from "lucide-react";

export async function getStaticPaths() {
  const caseStudies = await getCollection('case-studies');
  return caseStudies.map((study) => ({
    params: { slug: study.slug },
    props: { study },
  }));
}

const { study } = Astro.props;
const { Content } = await study.render();
---

<Layout 
  title={study.data.title}
  description={study.data.description}
  type="article"
>
  <Header />
  <main class="pt-16">
    <article class="py-20 px-4">
      <div class="container mx-auto max-w-4xl">
        <Button variant="ghost" asChild className="mb-8">
          <a href="/case-studies" class="inline-flex items-center gap-2 text-muted-foreground hover:text-foreground">
            <ArrowLeft className="h-4 w-4" />
            Back to Case Studies
          </a>
        </Button>
        
        <header class="mb-12">
          <div class="flex flex-wrap gap-2 mb-4">
            <Badge variant="secondary">{study.data.year}</Badge>
            <Badge variant="outline">{study.data.platform}</Badge>
            <Badge variant="outline">{study.data.region}</Badge>
          </div>
          
          <h1 class="text-4xl font-bold mb-4">{study.data.title}</h1>
          <p class="text-xl text-muted-foreground mb-6">{study.data.description}</p>
          
          <div class="flex items-center gap-4 text-muted-foreground">
            <span>Client: <strong class="text-foreground">{study.data.client}</strong></span>
          </div>
          
          {study.data.metrics && (
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-8 p-6 bg-muted/30 rounded-lg">
              {study.data.metrics.map((metric) => (
                <div class="text-center">
                  <div class="text-2xl font-bold">{metric.value}</div>
                  <div class="text-sm text-muted-foreground">{metric.label}</div>
                </div>
              ))}
            </div>
          )}
        </header>
        
        <div class="prose prose-lg dark:prose-invert max-w-none">
          <Content />
        </div>
        
        <div class="mt-12 pt-8 border-t border-border">
          <h3 class="font-semibold mb-4">Key Highlights</h3>
          <ul class="space-y-2">
            {study.data.highlights.map((highlight) => (
              <li class="flex items-start gap-2 text-muted-foreground">
                <span class="text-primary mt-1">â€¢</span>
                <span>{highlight}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </article>
  </main>
  <Footer />
</Layout>
